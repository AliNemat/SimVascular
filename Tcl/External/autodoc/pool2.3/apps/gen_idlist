#!/usr/local/bin/tclsh
# -*- tcl -*-
# A small tcl script to convert a 'tclIndex'
# into a batch file usable by NICS
# Writes generated data to stdout

# owner information will be found in the first file

set owner  ""
set oemail ""
set opass  ""

proc OwnerName     {args} {global owner;  set owner  [string trim $args]}
proc OwnerEmail    {args} {global oemail; set oemail [string trim $args]}
proc OwnerPassword {args} {global opass;  set opass  [string trim $args]}
source [lindex $argv 0]

puts "OwnerName $owner"
puts "OwnerEmail $oemail"
puts "OwnerPassword $opass"

# The package name is used as second argument

set pkg  [lindex $argv 1]

# scan all given index files

set argv [lrange $argv 2 end]

foreach f $argv {
    interp create -safe ~
    ~ expose source
    ~ eval set dir {{}}

    catch {~ eval source [list $f]} msg

    foreach p [~ eval array names auto_index] {
	puts ""
	puts "Command IdAdd"
	puts "DomainName Tcl commands"
	puts "IdName $p"
	puts "IdBrief << EOF"
	puts "EOF"
	puts "IdRef << EOF"
	puts "EOF"
	puts "IdUsage In use"
	puts "IdStandard Experimental"
	puts "IdOther << EOF"
	puts "This command is defined by package $pkg."
	puts "EOF"
    }

    interp delete ~
}
