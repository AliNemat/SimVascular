<html>
<head>
<title>File 'net/server.cls' (part of 'Pool_Net')</title>
<link rel=stylesheet href="styles.css"
 type="text/css">
</head>
<body >
<h1>File 'net/server.cls' (part of '<a href="pkg_Pool_Net.html" class="package">Pool_Net</a>')</h1>
<hr class="navbar">
<p class="navbar"><a href="index.htm" class="navbar">Home</a> | <a href="packages.html" class="index-package">Packages</a> | <a href="files.html" class="index-file">Files</a> | <a href="procs.html" class="index-procedure">Procedures</a> | <a href="classes.html" class="index-class">Classes</a> | <a href="namespaces.html" class="index-namespace">Namespaces</a> | <a href="keywords.html" class="index-keyword">Keywords</a> | <a href="deps.html" class="index-dependency">External packages</a> </p>
<hr class="navbar">

<div class="file-header">
<dl>
<dt><span class="header-title">Description (short)</span>
<dd><span class="header-description-value">Server construction kit.</span>
<dt><span class="header-title">Written by</span>
<dd><span class="header-author-value"><a href="mailto:a.kupries@westend.com" class="file-header">Andreas Kupries</a></span>
<dt><span class="header-title">Description</span>
<dd><span class="header-description-title">Framework for construction of line-oriented servers (like smtp, pop3, ...). See <a href="server.htm" class="xref-xref">background</a> for more information and <span class="xref-files"><a href="cpop3Server.html" class="file">net/pop3/server.cls</a></span> for an example of its usage. See <span class="xref-files"><a href="f_net_serverUtil.tcl.html" class="file">net/serverUtil.tcl</a></span> too.</span>
<dt><span class="header-title">Keywords</span>
<dd><span class="header-value">Server,  Framework for servers,  Construction of servers</span>
</dl>
</div>
<h1 class="class">Class 'server'</h1>
<div class="class-header">
<dl>
<dt><span class="header-title">Description</span>
<dd><span class="header-description-value">Base class for the construction of servers handling a line and command oriented protocol like SMTP, POP3, etc. Actual server classes should derive from it.</span>
<a name="MethodsUp"></a>
<dt><a href="#Methods" class="methods">Methods</a>
<dd><dl>
<dt><span class="visibility">public</span>
<dd><a href="cserver.html#pserver_Attach" class="proc">Attach</a> <span class="arg-list">(connId)</span><br>
<a href="cserver.html#pserver_CloseConnection" class="proc">CloseConnection</a> <span class="arg-list">()</span><br>
<a href="cserver.html#pserver_Detach" class="proc">Detach</a> <span class="arg-list">(connId)</span><br>
<a href="cserver.html#pserver_DoCloseConnection" class="proc">DoCloseConnection</a> <span class="arg-list">(connId)</span><br>
<a href="cserver.html#pserver_GreetPeer" class="proc">GreetPeer</a> <span class="arg-list">(connId)</span><br>
<a href="cserver.html#pserver_HandleCommand" class="proc">HandleCommand</a> <span class="arg-list">(connId sock)</span><br>
<a href="cserver.html#pserver_HandleNewConnection" class="proc">HandleNewConnection</a> <span class="arg-list">(sock rHost rPort)</span><br>
<a href="cserver.html#pserver_HandleUnknownCmd" class="proc">HandleUnknownCmd</a> <span class="arg-list">(connId cmd line)</span><br>
<a href="cserver.html#pserver_InitializeNewConnection" class="proc">InitializeNewConnection</a> <span class="arg-list">(connId)</span><br>
<a href="cserver.html#pserver_Log" class="proc">Log</a> <span class="arg-list">(level args)</span><br>
<a href="cserver.html#pserver_Respond2Client" class="proc">Respond2Client</a> <span class="arg-list">(conn ok text)</span><br>
<a href="cserver.html#pserver_SetCmdMap" class="proc">SetCmdMap</a> <span class="arg-list">(map)</span><br>
<a href="cserver.html#pserver_managesSock" class="proc">managesSock</a> <span class="arg-list">(sock)</span><br>
<a href="cserver.html#pserver_reportError" class="proc">reportError</a> <span class="arg-list">(sock errmsg)</span><br>
<a href="cserver.html#pserver_server" class="proc">server</a> <span class="arg-list">()</span><br>
<a href="cserver.html#pserver_start" class="proc">start</a> <span class="arg-list">()</span><br>
<a href="cserver.html#pserver_~server" class="proc">~server</a> <span class="arg-list">()</span>
</dl>

<a name="MembersUp"></a>
<dt><a href="#Members" class="members">Membervariables</a>
<dd><dl>
<dt><span class="visibility">public</span>
<dd><a href="#vport" class="members">port</a><br>
<a href="#vcmdMap" class="members">cmdMap</a><br>
<a href="#vsockMap" class="members">sockMap</a><br>
<a href="#vconnMap" class="members">connMap</a>
</dl>

</dl>
</div>
<hr class="class">
<a name="Methods"></a>
<h2 class="methods"><a href="#MethodsUp" class="methods">Methods</a></h2>
<a name="pserver_Attach"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">Attach</span> <span class="arg-list">(connId)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Reenables listening for commands for the given connection. See <span class="xref-mref"><a href="cserver.html#pserver_Detach" class="proc">Detach</a></span> too.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: connId
</td>
<td class="argument-description">
Connection identifier referencing into <span class="xref-vref"><a href="cserver.html#vconnMap" class="xref-vref">connMap</a></span>.
</td>
</tr>
</table>
</p>
<a name="pserver_CloseConnection"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">CloseConnection</span> <span class="arg-list">()</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Abstract method. Called by <span class="xref-mref"><a href="cserver.html#pserver_DoCloseConnection" class="proc">DoCloseConnection</a></span> to execute class specific code. Should do any class specific cleanup for the connection in destruction.</span>
</td>
</tr>
</table>
</p>
<a name="pserver_Detach"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">Detach</span> <span class="arg-list">(connId)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">After this call the given connection does not listen for commands anymore. This is useful to allow temporary operation of 'fcopy' et. al. The complementary command is <span class="xref-mref"><a href="cserver.html#pserver_Attach" class="proc">Attach</a></span>.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: connId
</td>
<td class="argument-description">
Connection identifier referencing into <span class="xref-vref"><a href="cserver.html#vconnMap" class="xref-vref">connMap</a></span>.
</td>
</tr>
</table>
</p>
<a name="pserver_DoCloseConnection"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">DoCloseConnection</span> <span class="arg-list">(connId)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Closes the connection described by <span class="argument"><span class="proc">connId</span></span>. Must be associated to this server. Closes the associated channel, then cleans and destroys the connection descriptor. Uses the abstract method <span class="xref-mref"><a href="cserver.html#pserver_CloseConnection" class="proc">CloseConnection</a></span> to execute class specific code.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: connId
</td>
<td class="argument-description">
Connection identifier referencing into <span class="xref-vref"><a href="cserver.html#vconnMap" class="xref-vref">connMap</a></span>.
</td>
</tr>
</table>
</p>
<a name="pserver_GreetPeer"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">GreetPeer</span> <span class="arg-list">(connId)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Abstract method. Called by <span class="xref-mref"><a href="cserver.html#pserver_HandleNewConnection" class="proc">HandleNewConnection</a></span> to execute class specific code. Should sent a greeting message to the new client.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: connId
</td>
<td class="argument-description">
Connection identifier referencing into <span class="xref-vref"><a href="cserver.html#vconnMap" class="xref-vref">connMap</a></span>.
</td>
</tr>
</table>
</p>
<a name="pserver_HandleCommand"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">HandleCommand</span> <span class="arg-list">(connId sock)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Called by the event system after arrival of a new command for connection <span class="argument"><span class="proc">connId</span></span>.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: connId
</td>
<td class="argument-description">
Connection identifier referencing into <span class="xref-vref"><a href="cserver.html#vconnMap" class="xref-vref">connMap</a></span>.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: sock
</td>
<td class="argument-description">
Direct access to the channel representing the connection.
</td>
</tr>
</table>
</p>
<a name="pserver_HandleNewConnection"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">HandleNewConnection</span> <span class="arg-list">(sock rHost rPort)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">A new connection to the server was opened. The connection descriptor is generated and initialized. A greeting will be sent upon sucessful completion of this task. In case of a failure the connection is closed immediately, without any response. Uses the abstract methods <span class="xref-mref"><a href="cserver.html#pserver_InitializeNewConnection" class="proc">InitializeNewConnection</a></span> and <span class="xref-mref"><a href="cserver.html#pserver_GreetPeer" class="proc">GreetPeer</a></span> to execute class specific setup code and the greeting of the new client.</span>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="proc">Notes</span>: This is the part of the code you have to change if you want to implement a host based access scheme.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: sock
</td>
<td class="argument-description">
The channel handle of the new connection.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: rHost
</td>
<td class="argument-description">
The host the client resides on.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: rPort
</td>
<td class="argument-description">
The port used by the client.
</td>
</tr>
</table>
</p>
<a name="pserver_HandleUnknownCmd"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">HandleUnknownCmd</span> <span class="arg-list">(connId cmd line)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Standard way of handling an unknown command sent by the client to us. The 'error' is catched in <span class="xref-mref"><a href="cserver.html#pserver_HandleCommand" class="proc">HandleCommand</a></span>, reported via</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: connId
</td>
<td class="argument-description">
Connection identifier referencing into <span class="xref-vref"><a href="cserver.html#vconnMap" class="xref-vref">connMap</a></span>.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: cmd
</td>
<td class="argument-description">
The name of the command not understood by the server.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: line
</td>
<td class="argument-description">
The complete line sent by the client.
</td>
</tr>
</table>
</p>
<a name="pserver_InitializeNewConnection"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">InitializeNewConnection</span> <span class="arg-list">(connId)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Abstract method. Called by <span class="xref-mref"><a href="cserver.html#pserver_HandleNewConnection" class="proc">HandleNewConnection</a></span> to execute class specific code. Should do any class specific initializations for the new connection.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: connId
</td>
<td class="argument-description">
Connection identifier referencing into <span class="xref-vref"><a href="cserver.html#vconnMap" class="xref-vref">connMap</a></span>.
</td>
</tr>
</table>
</p>
<a name="pserver_Log"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">Log</span> <span class="arg-list">(level args)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Convenience method, wraps around the syslog interface, automatically adds the server handle to the written text. See <span class="xref-procs"><a href="f_base_syslog.tcl.html#p_pool_syslog_syslog" class="proc">::pool::syslog::syslog</a></span> too.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: level
</td>
<td class="argument-description">
Relative importance of the logged message. Should be one of the strings returned by <span class="xref-procs"><a href="f_base_syslog.tcl.html#p_pool_syslog_levels" class="proc">::pool::syslog::levels</a></span>.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: args
</td>
<td class="argument-description">
List containing the texts to log.
</td>
</tr>
</table>
</p>
<a name="pserver_Respond2Client"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">Respond2Client</span> <span class="arg-list">(conn ok text)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Internal procedure. Writes a response <span class="argument"><span class="proc">text</span></span> to the client represented by <span class="argument"><span class="proc">conn</span></span>. To the caller it is equivalent to the builtin 'return'.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: conn
</td>
<td class="argument-description">
Descriptor of connection to write to.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: ok
</td>
<td class="argument-description">
Primary response, specific to the server subclass
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: text
</td>
<td class="argument-description">
Additional text following the primary response.
</td>
</tr>
</table>
</p>
<a name="pserver_SetCmdMap"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">SetCmdMap</span> <span class="arg-list">(map)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Used by derived classes to establish the mapping from command names to their handler methods.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: map
</td>
<td class="argument-description">
The mapping in 'array set/get' format.
</td>
</tr>
</table>
</p>
<a name="pserver_managesSock"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">managesSock</span> <span class="arg-list">(sock)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Used by the custom background handler in <span class="xref-files"><a href="f_net_serverUtil.tcl.html" class="file">net/serverUtil.tcl</a></span> to check wether a socket is handled by the queried server or not.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: sock
</td>
<td class="argument-description">
The handle of the socket to look for.
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="proc">Returns</span>: a boolean value. 1 indicates that the socket is handled here.
</td>
</tr>
</table>
</p>
<a name="pserver_reportError"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">reportError</span> <span class="arg-list">(sock errmsg)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Reports an error in the underlying server, closes the affected connection.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: sock
</td>
<td class="argument-description">
Handle of the channel representing the connection.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: errmsg
</td>
<td class="argument-description">
The message to print out.
</td>
</tr>
</table>
</p>
<a name="pserver_server"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">server</span> <span class="arg-list">()</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Constructor. Installs the custom background error handler upon the first call, see <span class="xref-files"><a href="f_net_serverUtil.tcl.html" class="file">net/serverUtil.tcl</a></span>. Always registers the new server in the map (&lt;cv servers&gt;) used by the error handler.</span>
</td>
</tr>
</table>
</p>
<a name="pserver_start"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">start</span> <span class="arg-list">()</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">A server is dormant until this method is called.</span>
</td>
</tr>
</table>
</p>
<a name="pserver_~server"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">~server</span> <span class="arg-list">()</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Destructor. This closes all currently open connections too.</span>
</td>
</tr>
</table>
</p>
<hr class="class">
<a name="Members"></a>
<h2 class="members"><a href="#MembersUp" class="members">Membervariables</a></h2>
<div class="members">
<dl>
<a name="vport"></a>
<dt><span class="variable-name">port</span>
<dd><span class="variable-description">  The port the server shall listen on for new connections. Must  be set by subclasses. The default value causes an error in  <span class="xref-mref"><a href="cserver.html#pserver_start" class="proc">start</a></span>.</span>
<a name="vcmdMap"></a>
<dt><span class="variable-name">cmdMap</span>
<dd><span class="variable-description">  Maps a command name to the <span class="members">method</span> handling it. Must  be set by subclasses, see <span class="xref-mref"><a href="cserver.html#pserver_SetCmdMap" class="proc">SetCmdMap</a></span>.</span>
<a name="vsockMap"></a>
<dt><span class="variable-name">sockMap</span>
<dd><span class="variable-description">  Together with <span class="xref-vref"><a href="cserver.html#vconnMap" class="xref-vref">connMap</a></span> the fundamental datastructure of a  server. This array maps from socket handles to a 3-element  list containing the remote host, remote port and internal  connection id of the connection running over the socket.</span>
<a name="vconnMap"></a>
<dt><span class="variable-name">connMap</span>
<dd><span class="variable-description">  Together with <span class="xref-vref"><a href="cserver.html#vsockMap" class="xref-vref">sockMap</a></span> the fundamental datastructure of a  server. This array maps from internal connection ids to the  handle of the socket used to talk to the client.</span>
</dl>
</div>
<hr class="navbar">
<p class="navbar"><a href="index.htm" class="navbar">Home</a> | <a href="packages.html" class="index-package">Packages</a> | <a href="files.html" class="index-file">Files</a> | <a href="procs.html" class="index-procedure">Procedures</a> | <a href="classes.html" class="index-class">Classes</a> | <a href="namespaces.html" class="index-namespace">Namespaces</a> | <a href="keywords.html" class="index-keyword">Keywords</a> | <a href="deps.html" class="index-dependency">External packages</a> </p>
<hr class="navbar">

<hr>
<p class="generated-by">Generated by <a href="http://www.oche.de/~akupries/soft/autodoc/index.htm" class="generated-by">AutoDoc 2.4</a> at 09/14/2000, invoked by <a href="mailto:a.kupries@westend.com" class="generated-by">Andreas Kupries</a></p>
</body>
</html>
