<html>
<head>
<title>File 'net/smtp/smtp.cls' (part of 'Pool_Net')</title>
<link rel=stylesheet href="styles.css"
 type="text/css">
</head>
<body >
<h1>File 'net/smtp/smtp.cls' (part of '<a href="pkg_Pool_Net.html" class="package">Pool_Net</a>')</h1>
<hr class="navbar">
<p class="navbar"><a href="index.htm" class="navbar">Home</a> | <a href="packages.html" class="index-package">Packages</a> | <a href="files.html" class="index-file">Files</a> | <a href="procs.html" class="index-procedure">Procedures</a> | <a href="classes.html" class="index-class">Classes</a> | <a href="namespaces.html" class="index-namespace">Namespaces</a> | <a href="keywords.html" class="index-keyword">Keywords</a> | <a href="deps.html" class="index-dependency">External packages</a> </p>
<hr class="navbar">

<div class="file-header">
<dl>
<dt><span class="header-title">Description (short)</span>
<dd><span class="header-description-value">SMTP conection management</span>
<dt><span class="header-title">Written by</span>
<dd><span class="header-author-value"><a href="mailto:a.kupries@westend.com" class="file-header">Andreas Kupries</a></span>
<dt><span class="header-title">Description</span>
<dd><span class="header-description-title">Management of SMTP connections</span>
<dt><span class="header-title">Keywords</span>
<dd><span class="header-value">SMTP,  management of SMTP connections, close smtp connection, open smtp connection, send mail</span>
</dl>
</div>
<h1 class="class">Class 'smtpConnection'</h1>
<div class="class-header">
<dl>
<dt><span class="header-title">Description</span>
<dd><span class="header-description-value">Instances of this class manages a connection to an smtp demon. The actual execution of command-reply sequences is delegated to sequencer classes derived from <span class="xref-classes"><a href="csmtpSequencer.html" class="class">smtpSequencer</a></span>. The methods encapsulating the access to these low-level exchanges are <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_Open" class="proc">Open</a></span>, <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_Close" class="proc">Close</a></span>, <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_Data" class="proc">Data</a></span> and <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_Prepare" class="proc">Prepare</a></span>. Based on these primitives a stateful high-level interface is formed (<span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_open" class="proc">open</a></span>, <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_close" class="proc">close</a></span> and <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_put" class="proc">put</a></span>). These methods call the appropriate primitives according to the state of the connection. I expect, that <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_put" class="proc">put</a></span> will be the most used method of this class.</span>
<a name="OptionsUp"></a>
<dt><span class="header-title"><a href="#Options" class="options">Options</a></span>
<dd><span class="header-value"><a href="#ohelo" class="options">helo</a><br>
<a href="#omaxtries" class="options">maxtries</a><br>
<a href="#oretrydelay" class="options">retrydelay</a><br>
<a href="#ohost" class="options">host</a><br>
<a href="#otimeout" class="options">timeout</a><br>
<a href="#oprogress" class="options">progress</a><br>
<a href="#oblocksize" class="options">blocksize</a></span>
<a name="MethodsUp"></a>
<dt><a href="#Methods" class="methods">Methods</a>
<dd><dl>
<dt><span class="visibility">public</span>
<dd><a href="csmtpConnection.html#psmtpConnection_ClearSocket" class="proc">ClearSocket</a> <span class="arg-list">()</span><br>
<a href="csmtpConnection.html#psmtpConnection_Close" class="proc">Close</a> <span class="arg-list">(completionMethod)</span><br>
<a href="csmtpConnection.html#psmtpConnection_Data" class="proc">Data</a> <span class="arg-list">(completionMethod message msgIsString)</span><br>
<a href="csmtpConnection.html#psmtpConnection_Finish" class="proc">Finish</a> <span class="arg-list">(seq)</span><br>
<a href="csmtpConnection.html#psmtpConnection_HandleOpened" class="proc">HandleOpened</a> <span class="arg-list">(seq)</span><br>
<a href="csmtpConnection.html#psmtpConnection_HandlePrepared" class="proc">HandlePrepared</a> <span class="arg-list">(seq)</span><br>
<a href="csmtpConnection.html#psmtpConnection_Open" class="proc">Open</a> <span class="arg-list">(completionMethod)</span><br>
<a href="csmtpConnection.html#psmtpConnection_Prepare" class="proc">Prepare</a> <span class="arg-list">(completionMethod from to)</span><br>
<a href="csmtpConnection.html#psmtpConnection_SetSock" class="proc">SetSock</a> <span class="arg-list">(s)</span><br>
<a href="csmtpConnection.html#psmtpConnection_close" class="proc">close</a> <span class="arg-list">(args)</span><br>
<a href="csmtpConnection.html#psmtpConnection_errorInfo" class="proc">errorInfo</a> <span class="arg-list">()</span><br>
<a href="csmtpConnection.html#psmtpConnection_open" class="proc">open</a> <span class="arg-list">(args)</span><br>
<a href="csmtpConnection.html#psmtpConnection_put" class="proc">put</a> <span class="arg-list">(args)</span><br>
<a href="csmtpConnection.html#psmtpConnection_smtpConnection" class="proc">smtpConnection</a> <span class="arg-list">()</span><br>
<a href="csmtpConnection.html#psmtpConnection_state" class="proc">state</a> <span class="arg-list">()</span><br>
<a href="csmtpConnection.html#psmtpConnection_~smtpConnection" class="proc">~smtpConnection</a> <span class="arg-list">()</span>
</dl>

<a name="MembersUp"></a>
<dt><a href="#Members" class="members">Membervariables</a>
<dd><dl>
<dt><span class="visibility">public</span>
<dd><a href="#vsock" class="members">sock</a><br>
<a href="#vstate" class="members">state</a><br>
<a href="#verror" class="members">error</a><br>
<a href="#vopState" class="members">opState</a>
</dl>

</dl>
</div>
<hr class="class">
<a name="Options"></a>
<h2 class="options"><a href="#OptionsUp" class="options">Options</a></h2>
<div class="options">
<dl>
<a name="ohelo"></a>
<dt><span class="option-name">-helo</span>
<dd><span class="option-description">        Specifies the string to use as argument for the HELO        command sent to the demon after its greeting.</span>
<a name="omaxtries"></a>
<dt><span class="option-name">-maxtries</span>
<dd><span class="option-description">    Specifies the maximum allowed number of trials to connect.    Defaults to 1.</span><br>
<span class="option-default">default value:</span> <span class="option-default-value">1</span>
<a name="oretrydelay"></a>
<dt><span class="option-name">-retrydelay</span>
<dd><span class="option-description">  Specifies the time to wait (in milliseconds) after a  failure before doing the next try. Defaults to 10 seconds.</span><br>
<span class="option-default">default value:</span> <span class="option-default-value">10000</span>
<a name="ohost"></a>
<dt><span class="option-name">-host</span>
<dd><span class="option-description">        Specifies the host the demon to connect to resides on.        Defaults to 'localhost'.</span><br>
<span class="option-default">default value:</span> <span class="option-default-value">localhost</span>
<a name="otimeout"></a>
<dt><span class="option-name">-timeout</span>
<dd><span class="option-description">     defines the number of milliseconds to wait before     aborting a smtp command without having a response.</span>
<a name="oprogress"></a>
<dt><span class="option-name">-progress</span>
<dd><span class="option-description">    If not empty, a command to evaluate with current    connection and number of bytes transfered so far as    arguments.</span>
<a name="oblocksize"></a>
<dt><span class="option-name">-blocksize</span>
<dd><span class="option-description">   Companion option to <span class="xref-oref"><a href="csmtpConnection.html#oprogress" class="xref-oref">progress</a></span>, optional. Defines the   size of the blocks to transfer between invocations of   <span class="xref-oref"><a href="csmtpConnection.html#oprogress" class="xref-oref">progress</a></span>. Ignored if <span class="xref-oref"><a href="csmtpConnection.html#oprogress" class="xref-oref">progress</a></span> is empty.</span><br>
<span class="option-default">default value:</span> <span class="option-default-value">1024</span>
</dl>
</div>
<hr class="class">
<a name="Methods"></a>
<h2 class="methods"><a href="#MethodsUp" class="methods">Methods</a></h2>
<a name="psmtpConnection_ClearSocket"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">ClearSocket</span> <span class="arg-list">()</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Closes the connection to the smtp demon described by this object.</span>
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_Close"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">Close</span> <span class="arg-list">(completionMethod)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Close connection to the smtp demon described by this object. Configures a <span class="xref-classes"><a href="csmtpCloseSeq.html" class="class">smtpCloseSeq</a></span> object and then delegates the work to it.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: completionMethod
</td>
<td class="argument-description">
The method to call after completion of the low-level sequencer.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_Data"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">Data</span> <span class="arg-list">(completionMethod message msgIsString)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Executes the transfer of a message body via SMTP protocol. Configures a <span class="xref-classes"><a href="csmtpDataSeq.html" class="class">smtpDataSeq</a></span> object and then delegates the work to it.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: completionMethod
</td>
<td class="argument-description">
The method to call after completion of the low-level sequencer.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: message
</td>
<td class="argument-description">
Handle of the channel containing the message to send over (or the message itself (<span class="argument"><span class="argument-description">msgIsString</span></span> = TRUE)).
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: msgIsString (= 0)
</td>
<td class="argument-description">
A boolean value. Set if <span class="argument"><span class="argument-description">message</span></span> is no channel handle, but the message itself.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_Finish"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">Finish</span> <span class="arg-list">(seq)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Called by all highlevel sequencers at the end of their operation. Retrieves the state of the invoking sequencers and changes the state of the connection accordingly. Detection of errors cause the shutdown of the connection to the demon.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: seq (= {})
</td>
<td class="argument-description">
Handle of the sequencer finishing its operation. Empty if the requested operation was a no-op. In that case it was called immediately too.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_HandleOpened"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">HandleOpened</span> <span class="arg-list">(seq)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Called after completion of the open sequencer <span class="argument"><span class="proc">seq</span></span> during a <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_put" class="proc">put</a></span> transaction. Initiates the preparation transaction if no error came back to us.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: seq
</td>
<td class="argument-description">
Handle of the finishing sequencer.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_HandlePrepared"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">HandlePrepared</span> <span class="arg-list">(seq)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Called after completion of the prepare sequencer <span class="argument"><span class="proc">seq</span></span>. Initiates the data transfer if no error came back to us</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: seq
</td>
<td class="argument-description">
Handle of the finishing sequencer.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_Open"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">Open</span> <span class="arg-list">(completionMethod)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Opens a connection to the smtp demon described by this object. Configures a <span class="xref-classes"><a href="csmtpOpenSeq.html" class="class">smtpOpenSeq</a></span> object and then delegates the work to it.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: completionMethod
</td>
<td class="argument-description">
The method to call after completion of the low-level sequencer.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_Prepare"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">Prepare</span> <span class="arg-list">(completionMethod from to)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Prepares the transfer of a mail message by specifying sender and recipients to the smtp demon described by this object. Configures a <span class="xref-classes"><a href="csmtpPrepareSeq.html" class="class">smtpPrepareSeq</a></span> object and then delegates the work to it.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: completionMethod
</td>
<td class="argument-description">
The method to call after completion of the low-level sequencer.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: from
</td>
<td class="argument-description">
The address of the sender.
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: to
</td>
<td class="argument-description">
A list containing the addresses of the intended receivers.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_SetSock"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">SetSock</span> <span class="arg-list">(s)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Accessor method, used by the <span class="xref-classes"><a href="csmtpOpenSeq.html" class="class">smtpOpenSeq</a></span> sequencer to transfer information about the channel representing the connection to the smtp demon.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: s
</td>
<td class="argument-description">
The handle of the channel representing the connection to the smtp demon.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_close"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">close</span> <span class="arg-list">(args)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Closes the connection to the smtp demon. The low-level method <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_Close" class="proc">Close</a></span> is used to execute the task. Configured by a list of option/value pairs.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: args
</td>
<td class="argument-description">
List of option/value pairs.<br>
 Recognized and required is -command.<br>
 It defines a script to be executed after the transaction completed.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_errorInfo"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">errorInfo</span> <span class="arg-list">()</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="proc">Returns</span>: the error information of the SMTP connection. Valid only in case of state = error.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_open"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">open</span> <span class="arg-list">(args)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Opens the connection to the smtp demon. The low-level method <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_Open" class="proc">Open</a></span> is used to execute the task. Configured by a list of option/value pairs.</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: args
</td>
<td class="argument-description">
List of option/value pairs.<br>
 Recognized and required is -command.<br>
 It defines a script to be executed after the transaction completed.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_put"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">put</span> <span class="arg-list">(args)</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Send a mail to the smtp demon. The low-level methods <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_Prepare" class="proc">Prepare</a></span> and <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_Data" class="proc">Data</a></span> are used to execute the task. Configured by a list of option/value pairs. Will open the connection if necessary (via <span class="xref-mref"><a href="csmtpConnection.html#psmtpConnection_Open" class="proc">Open</a></span>).</span>
</td>
</tr>
<tr class="proc">
<td class="argument-name">
<span class="argument-name">Argument</span>: args
</td>
<td class="argument-description">
List of option/value pairs.<br>
 Recognized are -command, -message, -from, -to and -string.<br>
 Required are -command, -message, -from and -to.<br>
 -command specifies a script to be executed after completion.<br>
 -message is interpreted as channel containing the message to be send, or the message itself (if -string is set to true).<br>
 -from specifies the sender of the mail.<br>
 -to is interpreted as a list of recipient addresses.<br>
 -string is boolean value indicating wether -message is the channel containing it (false), or the message itself (true). This is optional and defaults to false.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_smtpConnection"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">smtpConnection</span> <span class="arg-list">()</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Constructor. Just logs the event.</span>
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_state"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">state</span> <span class="arg-list">()</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="proc">Returns</span>: the state of the SMTP connection.
</td>
</tr>
</table>
</p>
<a name="psmtpConnection_~smtpConnection"></a>
<p class="proc"><table border width=100% class="proc">
<tr class="proc">
<td colspan=2 class="proc">
<h2 class="proc"><span class="proc-name">~smtpConnection</span> <span class="arg-list">()</span></h2>
</td>
</tr>
<tr class="proc">
<td colspan=2 class="proc">
<span class="header-description-value">Destructor. Closes an active socket and logs the event.</span>
</td>
</tr>
</table>
</p>
<hr class="class">
<a name="Members"></a>
<h2 class="members"><a href="#MembersUp" class="members">Membervariables</a></h2>
<div class="members">
<dl>
<a name="vsock"></a>
<dt><span class="variable-name">sock</span>
<dd><span class="variable-description">   The handle of the channel controlled by this object</span>
<a name="vstate"></a>
<dt><span class="variable-name">state</span>
<dd><span class="variable-description">  The state of the last executed command.</span>
<a name="verror"></a>
<dt><span class="variable-name">error</span>
<dd><span class="variable-description">  The error message of the last executed, failed command.</span>
<a name="vopState"></a>
<dt><span class="variable-name">opState</span>
<dd><span class="variable-description">  Contains the state of the currently running highlevel  transaction.</span>
</dl>
</div>
<hr class="navbar">
<p class="navbar"><a href="index.htm" class="navbar">Home</a> | <a href="packages.html" class="index-package">Packages</a> | <a href="files.html" class="index-file">Files</a> | <a href="procs.html" class="index-procedure">Procedures</a> | <a href="classes.html" class="index-class">Classes</a> | <a href="namespaces.html" class="index-namespace">Namespaces</a> | <a href="keywords.html" class="index-keyword">Keywords</a> | <a href="deps.html" class="index-dependency">External packages</a> </p>
<hr class="navbar">

<hr>
<p class="generated-by">Generated by <a href="http://www.oche.de/~akupries/soft/autodoc/index.htm" class="generated-by">AutoDoc 2.4</a> at 09/14/2000, invoked by <a href="mailto:a.kupries@westend.com" class="generated-by">Andreas Kupries</a></p>
</body>
</html>
